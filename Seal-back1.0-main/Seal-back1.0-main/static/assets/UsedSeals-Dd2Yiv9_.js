import{_ as h,U as b,c,a as s,b as S,f as i,e as u,v as p,i as v,g as f,x as y,w,t as C,l as k,y as I,r as N,o as d}from"./index-BvItkERQ.js";const U="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NDI4NjgzMjgsInJvbGUiOiJ0ZWNobmljaWFuIiwidGVjaF9pZCI6MjEsInVzZXJuYW1lIjoiY2F0In0.uFkWy5G9-ttlJnRogHzfHGPJVC1SBwuUjaprSBbuys0",g=k.create({baseURL:"http://192.168.2.6:5173",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U}`}}),_={name:"UsedSeals",components:{QrcodeStream:b},data(){return{returnSealCode:"",returnNote:"",showScanner:!1,scannerMessage:"กำลังเปิดกล้อง...",worker:null,isWorkerReady:!1,usageStatus:"used"}},async created(){try{this.worker=await I.createWorker("eng"),this.isWorkerReady=!0}catch(n){console.error("Error initializing Tesseract:",n)}},beforeDestroy(){this.worker&&this.worker.terminate()},methods:{openScanner(){this.showScanner=!0},closeScanner(){this.showScanner=!1},async onInit(n){try{await n,this.scannerMessage="วางรหัส Seal ให้อยู่ในกรอบ"}catch(e){console.error("Init error:",e),this.showScanner=!1,alert("ไม่สามารถเริ่มต้นกล้องได้")}},onDecode(n){this.returnSealCode=n,this.showScanner=!1},async onFileSelected(n){},async returnSeal(){var n,e;if(!this.returnSealCode){alert("กรุณากรอกรหัส Seal");return}try{const o={seal_number:this.returnSealCode,remark:this.returnNote||""};let l;if(this.usageStatus==="used"?l=await g.put(`/api/seals/${this.returnSealCode}/return`,o):l=await g.put(`/api/seals/${this.returnSealCode}/cancel`,o),l.data&&!l.data.error){const a=JSON.parse(localStorage.getItem("sealHistory")||"[]");a.unshift({type:this.usageStatus==="used"?"used":"cancelled",icon:this.usageStatus==="used"?"fas fa-check-double":"fas fa-ban",title:this.usageStatus==="used"?"ใช้งาน Seal":"ยกเลิกการใช้งาน Seal",details:`รหัส: ${this.returnSealCode}`,time:new Date().toLocaleString("th-TH")}),localStorage.setItem("sealHistory",JSON.stringify(a)),alert("✅ บันทึกการคืน Seal สำเร็จ"),this.resetForm()}}catch(o){console.error("Return error:",o),o.response&&console.log("Error response:",o.response.data),alert(`❌ ${((e=(n=o.response)==null?void 0:n.data)==null?void 0:e.message)||"เกิดข้อผิดพลาดในการบันทึกข้อมูล"}`)}},resetForm(){this.returnSealCode="",this.returnNote="",this.usageStatus="used"}}},x={class:"used-seals"},J={class:"form-container"},V={class:"return-form"},D={class:"form-group"},j={class:"input-group with-button"},F={class:"input-wrapper"},R={class:"form-group"},B={class:"input-group"},M={class:"input-wrapper"},W={class:"form-group"},z={class:"toggle-group"},E={class:"toggle-button"},H={class:"toggle-button"},T=["disabled"],G={key:0,class:"scanner-modal"},O={class:"scanner-container"},q={class:"scanner-header"},Z={class:"scanner-controls"},A={class:"control-button"},K={class:"scanner-frame"},L={class:"scanner-hint"};function Q(n,e,o,l,a,r){const m=N("qrcode-stream");return d(),c("div",x,[e[22]||(e[22]=s("div",{class:"header"},[s("div",{class:"header-content"},[s("h1",null,[s("i",{class:"fas fa-undo-alt"}),i(" คืน Seal")]),s("p",{class:"subtitle"},"บันทึกการคืน Seal ที่ใช้งานแล้ว")])],-1)),s("div",J,[s("div",V,[s("div",D,[e[11]||(e[11]=s("label",null,"รหัส Seal",-1)),s("div",j,[s("div",F,[e[9]||(e[9]=s("i",{class:"fas fa-barcode"},null,-1)),u(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>a.returnSealCode=t),placeholder:"กรอกหรือสแกนรหัส Seal",onKeyup:e[1]||(e[1]=v((...t)=>r.returnSeal&&r.returnSeal(...t),["enter"]))},null,544),[[p,a.returnSealCode]])]),s("button",{class:"scan-btn",onClick:e[2]||(e[2]=(...t)=>r.openScanner&&r.openScanner(...t)),title:"สแกน QR Code"},e[10]||(e[10]=[s("i",{class:"fas fa-qrcode"},null,-1)]))])]),s("div",R,[e[13]||(e[13]=s("label",null,"หมายเหตุการคืน",-1)),s("div",B,[s("div",M,[e[12]||(e[12]=s("i",{class:"fas fa-comment-alt"},null,-1)),u(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.returnNote=t),placeholder:"ระบุสาเหตุการคืน Seal",rows:"3"},null,512),[[p,a.returnNote]])])])]),s("div",W,[e[16]||(e[16]=s("label",null,"สถานะการใช้งาน",-1)),s("div",z,[s("label",E,[u(s("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=t=>a.usageStatus=t),value:"used",name:"usage-status"},null,512),[[f,a.usageStatus]]),e[14]||(e[14]=s("span",{class:"toggle-label"},[s("i",{class:"fas fa-check-circle"}),i(" ใช้งานแล้ว ")],-1))]),s("label",H,[u(s("input",{type:"radio","onUpdate:modelValue":e[5]||(e[5]=t=>a.usageStatus=t),value:"unused",name:"usage-status"},null,512),[[f,a.usageStatus]]),e[15]||(e[15]=s("span",{class:"toggle-label"},[s("i",{class:"fas fa-times-circle"}),i(" ยังไม่ได้ใช้งาน ")],-1))])])]),s("button",{class:"submit-btn",onClick:e[6]||(e[6]=(...t)=>r.returnSeal&&r.returnSeal(...t)),disabled:!a.returnSealCode},e[17]||(e[17]=[s("i",{class:"fas fa-check-circle"},null,-1),i(" บันทึกการคืน Seal ")]),8,T)])]),a.showScanner?(d(),c("div",G,[s("div",O,[s("div",q,[e[20]||(e[20]=s("h2",null,[s("i",{class:"fas fa-qrcode"}),i(" สแกน Seal")],-1)),s("div",Z,[s("label",A,[e[18]||(e[18]=s("i",{class:"fas fa-camera"},null,-1)),s("input",{type:"file",accept:"image/*",onChange:e[7]||(e[7]=(...t)=>r.onFileSelected&&r.onFileSelected(...t)),style:{display:"none"}},null,32)]),s("button",{class:"close-scanner",onClick:e[8]||(e[8]=(...t)=>r.closeScanner&&r.closeScanner(...t))},e[19]||(e[19]=[s("i",{class:"fas fa-times"},null,-1)]))])]),s("div",K,[a.showScanner?(d(),y(m,{key:0,onDecode:r.onDecode,onInit:r.onInit},{default:w(()=>e[21]||(e[21]=[s("div",{class:"scan-target-frame"},[s("div",{class:"corner top-left"}),s("div",{class:"corner top-right"}),s("div",{class:"corner bottom-left"}),s("div",{class:"corner bottom-right"})],-1)])),_:1},8,["onDecode","onInit"])):S("",!0)]),s("p",L,C(a.scannerMessage),1)])])):S("",!0)])}const Y=h(_,[["render",Q],["__scopeId","data-v-f52841b0"]]);export{Y as default};
